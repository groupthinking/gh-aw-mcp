#
#    ___                   _   _      
#   / _ \                 | | (_)     
#  | |_| | __ _  ___ _ __ | |_ _  ___ 
#  |  _  |/ _` |/ _ \ '_ \| __| |/ __|
#  | | | | (_| |  __/ | | | |_| | (__ 
#  \_| |_/\__, |\___|_| |_|\__|_|\___|
#          __/ |
#  _    _ |___/ 
# | |  | |                / _| |
# | |  | | ___ _ __ _  __| |_| | _____      ____
# | |/\| |/ _ \ '__| |/ /|  _| |/ _ \ \ /\ / / ___|
# \  /\  / (_) | | | | ( | | | | (_) \ V  V /\__ \
#  \/  \/ \___/|_| |_|\_\|_| |_|\___/ \_/\_/ |___/
#
# This file was automatically generated by pkg/workflow/maintenance_workflow.go (v0.35.1). DO NOT EDIT.
#
# To regenerate this workflow, run:
#   gh aw compile
# For more information: https://github.com/githubnext/gh-aw/blob/main/.github/aw/github-agentic-workflows.md
#
# Alternative regeneration methods:
# make recompile
# 
# Or use the gh-aw CLI directly:
# ./gh-aw compile --validate --verbose
# 
# The workflow is generated when any workflow uses the 'expires' field
# in create-discussions or create-issues safe-outputs configuration.
# Schedule frequency is automatically determined by the shortest expiration time.
#
name: Agentics Maintenance

on:
  schedule:
    - cron: "37 */2 * * *"  # Every 2 hours (based on minimum expires: 1 days)
  workflow_dispatch:

permissions: {}

jobs:
  close-expired-discussions:
    runs-on: ubuntu-latest
    permissions:
      discussions: write
    steps:
      - name: Setup Scripts
        uses: githubnext/gh-aw/actions/setup@v0.35.1
        with:
          destination: /tmp/gh-aw/actions

      - name: Close expired discussions
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
        with:
          script: |
            const { setupGlobals } = require('/tmp/gh-aw/actions/setup_globals.cjs');
            setupGlobals(core, github, context, exec, io);
            const { main } = require('/tmp/gh-aw/actions/close_expired_discussions.cjs');
            await main();

  close-expired-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Setup Scripts
        uses: githubnext/gh-aw/actions/setup@v0.35.1
        with:
          destination: /tmp/gh-aw/actions

      - name: Close expired issues
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
        with:
          script: |
            const { setupGlobals } = require('/tmp/gh-aw/actions/setup_globals.cjs');
            setupGlobals(core, github, context, exec, io);
            const { main } = require('/tmp/gh-aw/actions/close_expired_issues.cjs');
            await main();

  compile-workflows:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Setup Go
        uses: actions/setup-go@41dfa10bad2bb2ae585af6ee5bb4d7d973ad74ed # v5.1.0
        with:
          go-version-file: go.mod
          cache: true

      - name: Build gh-aw
        run: make build

      - name: Compile workflows
        run: |
          ./gh-aw compile --validate --verbose
          echo "✓ All workflows compiled successfully"

      - name: Check for out-of-sync workflows
        run: |
          if git diff --exit-code .github/workflows/*.lock.yml; then
            echo "✓ All workflow lock files are up to date"
          else
            echo "::error::Some workflow lock files are out of sync. Run 'make recompile' locally."
            echo "::group::Diff of out-of-sync files"
            git diff .github/workflows/*.lock.yml
            echo "::endgroup::"
            exit 1
          fi

  zizmor-scan:
    runs-on: ubuntu-latest
    needs: compile-workflows
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Setup Go
        uses: actions/setup-go@41dfa10bad2bb2ae585af6ee5bb4d7d973ad74ed # v5.1.0
        with:
          go-version-file: go.mod
          cache: true

      - name: Build gh-aw
        run: make build

      - name: Run zizmor security scanner
        run: |
          ./gh-aw compile --zizmor --verbose
          echo "✓ Zizmor security scan completed"
